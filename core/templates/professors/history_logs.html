{% load static %}
        
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>History Logs</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/feather/feather.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/mdi/css/materialdesignicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/ti-icons/css/themify-icons.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/typicons/typicons.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/simple-line-icons/css/simple-line-icons.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/css/vendor.bundle.base.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css' %}">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/datatables.net-bs4/dataTables.bootstrap4.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'admin_dashboard/assets/js/select.dataTables.min.css' %}">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/css/style.css' %}">
    <!-- endinject -->
    <link rel="shortcut icon" href="{% static 'admin_dashboard/assets/images/favicon.png' %}" />

    <style>
        .floating-alert {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050; /* Ensure it appears above other elements */
            width: 300px; /* Adjust width as needed */
        }
    </style>
    
  </head>
  <body class="with-welcome-text">
    <div class="container-scroller">
      <!-- partial:partials/_navbar.html -->
      {% include 'header/header.html'%}
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_sidebar.html -->
         
        {% include 'navbar/navbar.html' %}

        <!-- partial end -->
         
<div class="main-panel">
    <div class="container-fluid">
        <h2 class="mt-4">User Activity Logs</h2>

        <!-- Search bar -->
        <div class="row">
            <div class="col-md-6">
                <input type="text" class="form-control search-bar" placeholder="Search by username or email" id="searchInput">
            </div>
        </div>

<!-- Table containing activity logs -->
<div class="table-responsive">
    <table class="table table-hover table-bordered w-100 mt-3" id="userLogsTable">
        <thead class="table-dark">
            <tr>
                <th>Username</th>
                <th>Action</th>
                <th>Description</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody>
            {% for log in activity_logs %}
            <tr>
                <td>{{ log.user.username }}</td>
                <td>{{ log.get_action_display }}</td> <!-- Display action name (e.g., Login, Submission) -->
                <td>{{ log.description }}</td> <!-- Display the description of the action -->
                <td>{{ log.timestamp|date:"Y-m-d H:i:s" }}</td> <!-- Display timestamp -->
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
    </div>
     
    <!-- Pagination controls -->
    <nav aria-label="User logs pagination">
        <ul class="pagination justify-content-center mt-4" id="paginationControls"></ul>
    </nav>
</div>

{% include 'notification/admin_notification.html' %}

<script>
    // Pagination and search settings
    const rowsPerPage = 5;
    let currentPage = 1;
    let filteredUsers = []; // Stores the filtered user rows based on the search input

    function displayTablePage(page) {
        const rows = document.querySelectorAll('#userLogsTable tbody tr');
        const totalRows = filteredUsers.length; // Only count filtered users
        const totalPages = Math.ceil(totalRows / rowsPerPage);
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        // Hide all rows initially
        rows.forEach(row => {
            row.style.display = 'none'; // Hide all rows first
        });

        // Show only the current page of filtered results
        filteredUsers.slice(start, end).forEach(row => {
            row.style.display = ''; // Show rows in the current page
        });

        // Update pagination controls
        const paginationControls = document.getElementById('paginationControls');
        paginationControls.innerHTML = '';

        // Previous button
        const prevItem = document.createElement('li');
        prevItem.className = 'page-item ' + (page === 1 ? 'disabled' : '');
        prevItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${page - 1})" tabindex="-1" aria-disabled="${page === 1}">Previous</a>`;
        paginationControls.appendChild(prevItem);

        // Page number buttons
        for (let i = 1; i <= totalPages; i++) {
            const pageItem = document.createElement('li');
            pageItem.className = 'page-item ' + (i === page ? 'active' : '');
            pageItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
            paginationControls.appendChild(pageItem);
        }

        // Next button
        const nextItem = document.createElement('li');
        nextItem.className = 'page-item ' + (page === totalPages ? 'disabled' : '');
        nextItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${page + 1})">Next</a>`;
        paginationControls.appendChild(nextItem);
    }

    function changePage(page) {
        const totalPages = Math.ceil(filteredUsers.length / rowsPerPage);
        if (page < 1 || page > totalPages) return; // Out of bounds
        currentPage = page;
        displayTablePage(currentPage);
    }

    // Search functionality for the user table
    document.getElementById('searchInput').addEventListener('keyup', function() {
        let filter = this.value.toUpperCase();
        const rows = document.querySelectorAll('#userLogsTable tbody tr');

        // Filter rows based on search input
        filteredUsers = Array.from(rows).filter(row => {
            let username = row.cells[0].textContent.toUpperCase();
            let email = row.cells[1].textContent.toUpperCase();
            return username.indexOf(filter) > -1 || email.indexOf(filter) > -1;
        });

        // Reset pagination to the first page after search
        currentPage = 1;
        displayTablePage(currentPage);

        // Check if there are any filtered results
        if (filteredUsers.length === 0) {
            document.querySelector('#paginationControls').innerHTML = '<li class="page-item disabled"><a class="page-link" href="#">No results found</a></li>';
        }
    });

    // Initial setup
    const allRows = Array.from(document.querySelectorAll('#userLogsTable tbody tr')); // Store all rows
    filteredUsers = allRows; // Initialize with all users
    displayTablePage(currentPage);
</script>

    <!-- plugins:js -->
    <script src="{% static 'admin_dashboard/assets/vendors/js/vendor.bundle.base.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js' %}"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="{% static 'admin_dashboard/assets/vendors/chart.js/chart.umd.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/vendors/progressbar.js/progressbar.min.js' %}"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="{% static 'admin_dashboard/assets/js/off-canvas.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/template.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/settings.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/hoverable-collapse.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/todolist.js' %}"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="{% static 'admin_dashboard/assets/js/jquery.cookie.js' %}" type="text/javascript"></script>
    <script src="{% static 'admin_dashboard/assets/js/dashboard.js' %}"></script>
    <!-- <script src="assets/js/Chart.roundedBarCharts.js"></script> -->
    <!-- End custom js for this page-->
  </body>
</html>