{% load static %}
        
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>View Users</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/feather/feather.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/mdi/css/materialdesignicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/ti-icons/css/themify-icons.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/typicons/typicons.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/simple-line-icons/css/simple-line-icons.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/css/vendor.bundle.base.css' %}">
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css' %}">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/vendors/datatables.net-bs4/dataTables.bootstrap4.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'admin_dashboard/assets/js/select.dataTables.min.css' %}">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="{% static 'admin_dashboard/assets/css/style.css' %}">
    <!-- endinject -->
    <link rel="shortcut icon" href="{% static 'admin_dashboard/assets/images/favicon.png' %}" />

    <style>
        .floating-alert {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050; /* Ensure it appears above other elements */
            width: 300px; /* Adjust width as needed */
        }
    </style>
    
  </head>
  <body class="with-welcome-text">
    <div class="container-scroller">
      <!-- partial:partials/_navbar.html -->
      {% include 'header/header.html'%}
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_sidebar.html -->
         
        {% include 'navbar/navbar.html' %}

        <!-- partial end -->
         
        <div class="main-panel">
            <div class="content-wrapper">
                <h2 class="mt-4">Users List</h2>
        
                <!-- Search Bar and Section Filter -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex">
                        <input id="searchInput" type="text" class="form-control w-50" placeholder="Search Users..." oninput="filterUsers()">
                        <select id="sectionFilter" class="form-control ms-3" onchange="filterUsers()">
                            <option value="">All Sections</option>
                            {% for section in sections %}
                                <option value="{{ section }}">{{ section }}</option>
                            {% endfor %}
                        </select>
                    </div>
        
                    <div>
                        <!-- Default value is set to "Student" -->
                        <select id="roleFilter" class="form-control ms-3" onchange="filterUsers()">
                            <option value="student" selected>Student</option>
                            <option value="professor">Professor</option>
                        </select>
                    </div>
                </div>
        
                <!-- Scrollable Table -->
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped table-bordered w-100" id="usersTable">
                        <thead class="table-dark" style="position: sticky; top: 0; z-index: 1020;">
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th class="section-column">Section</th>
                                <th>Teams</th>
                                <th>Verification Status</th>
                                <th class="actions-column">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            {% for user in users %}
                            <tr class="user-row" data-section="{{ user.userprofile.section }}" data-role="{{ user.userprofile.role }}" data-username="{{ user.username | lower }}" data-email="{{ user.email | lower }}">
                                <td>{{ user.username }}</td>
                                <td>{{ user.email }}</td>
                                <td>
                                    {% if user.userprofile.role == 'student' %}
                                        Student
                                    {% elif user.userprofile.role == 'professor' %}
                                        Professor
                                    {% else %}
                                        Unknown
                                    {% endif %}
                                </td>
                                <td class="section-column">{{ user.userprofile.section }}</td>
                                <td>
                                    {% if user.teams.exists %}
                                        {% for team in user.teams.all %}
                                            {{ team.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        NO TEAM
                                    {% endif %}
                                </td>
                                <td>
                                    {% if user.userprofile.verified %}
                                        <span class="badge bg-success">Verified</span>
                                    {% else %}
                                        <span class="badge bg-danger">Not Verified</span>
                                    {% endif %}
                                </td>
                                <td class="actions-column">
                                    <div class="btn-group" role="group">
                                        {% if not user.is_superuser %}
                                        <button type="button" class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#changeVerificationStatusModal" data-user-id="{{ user.id }}" data-verified="{{ user.userprofile.verified }}" title="Change Verification Status">
                                            <i class="mdi mdi-check-circle-outline"></i>
                                        </button>
                                        <button type="button" class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#editTeamModal" data-user-id="{{ user.id }}" title="Edit Teams">
                                            <i class="mdi mdi-account-group"></i>
                                        </button>
                                        <button type="button" class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#editSectionModal" data-user-id="{{ user.id }}" data-section="{{ user.userprofile.section }}" title="Edit Section">
                                            <i class="mdi mdi-clipboard-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#removeUserFromTeamModal" data-user-id="{{ user.id }}" title="Remove from Team">
                                            <i class="mdi mdi-account-remove-outline"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>        
        
        
     

    {% include 'notification/admin_notification.html' %}

    {% include 'modal/edit_users.html' %}
   
   
    <!-- JavaScript for Search Functionality -->
    <script>
        function filterUsers() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const sectionFilter = document.getElementById('sectionFilter').value;
            const roleFilter = document.getElementById('roleFilter').value;
            const rows = document.querySelectorAll('.user-row');
            const sectionColumns = document.querySelectorAll('.section-column');
            const actionsColumns = document.querySelectorAll('.actions-column');
        
            rows.forEach(row => {
                const username = row.getAttribute('data-username');
                const email = row.getAttribute('data-email');
                const role = row.getAttribute('data-role');
                const section = row.getAttribute('data-section');
        
                const matchesSearch = username.includes(searchInput) || email.includes(searchInput);
                const matchesSection = sectionFilter === '' || section === sectionFilter;
                const matchesRole = roleFilter === '' || role === roleFilter;
        
                if (matchesSearch && matchesSection && matchesRole) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        
            // Show/hide the "Section" and "Actions" columns if the role is "Professor"
            if (roleFilter === 'professor') {
                sectionColumns.forEach(col => col.style.display = 'none');
                actionsColumns.forEach(col => col.style.display = 'none');
            } else {
                sectionColumns.forEach(col => col.style.display = '');
                actionsColumns.forEach(col => col.style.display = '');
            }
        }
        
        // Initialize filters on input and change events
        document.getElementById('searchInput').addEventListener('input', filterUsers);
        document.getElementById('sectionFilter').addEventListener('change', filterUsers);
        document.getElementById('roleFilter').addEventListener('change', filterUsers);
        
        // Trigger default filter on page load
        window.addEventListener('DOMContentLoaded', filterUsers);

    </script>

    <!-- plugins:js -->
    <script src="{% static 'admin_dashboard/assets/vendors/js/vendor.bundle.base.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js' %}"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="{% static 'admin_dashboard/assets/vendors/chart.js/chart.umd.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/vendors/progressbar.js/progressbar.min.js' %}"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="{% static 'admin_dashboard/assets/js/off-canvas.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/template.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/settings.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/hoverable-collapse.js' %}"></script>
    <script src="{% static 'admin_dashboard/assets/js/todolist.js' %}"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="{% static 'admin_dashboard/assets/js/jquery.cookie.js' %}" type="text/javascript"></script>
    <script src="{% static 'admin_dashboard/assets/js/dashboard.js' %}"></script>
    <!-- <script src="assets/js/Chart.roundedBarCharts.js"></script> -->
    <!-- End custom js for this page-->
  </body>
</html>